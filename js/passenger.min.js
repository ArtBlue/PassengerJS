/**
 * Passenger JS
 * @author 	Arthur Khachatryan
 * @beta
 * @version 0.7
 * @date 	05/11/2015
 */
function Passenger(e){if(!e||!e.field)return console.log("Error: config, and at minimum the password field ID is required.");var t=this;t.sBoxID=e.field;{var r=e.field,s=t.getElement(r),n=e.contracts||t.getContracts(),a=(n.length,t.createBox(s,n,e)),o=t.inputTypeToggle(s);t.boxDisplayToggle(o,a)}return t.box=a,t.contracts=n,t.nContracts=t.contracts.length,t.setupBoxEvents(s,a),passengers[t.sBoxID]={fulfilled:!1},t.allPassed=t.isPassFulfilled,t}function _after(e){var t=e.el,r=e.selNew,s=document.createElement(r),n=e.sID,a=e.sCSS,o=e.sText,l=e.aAttr,i=0;if(n&&(s.id=n),o){var c=document.createTextNode(o);s.appendChild(c)}if(a&&(s.className=a),l)for(;i<l.length;i++)s.setAttribute(l[i].name,l[i].val);return t.nextSibling?t.parentNode.insertBefore(s,t.nextSibling):t.parentNode.appendChild(s),s}function _appendChild(e){var t=e.el,r=e.selNew,s=document.createElement(r),n=e.sID,a=e.sCSS,o=e.sText,l=e.sStyes;if(n&&(s.id=n),o){var i=document.createTextNode(o);s.appendChild(i)}if(a&&(s.className=a),l){var c=document.createAttribute("style");c.value=l,s.setAttributeNode(c)}return t.appendChild(s),s}var passengers={};Passenger.prototype.isPassFulfilled=function(){return passengers[this.sBoxID].fulfilled},Passenger.prototype.createBox=function(e,t,r){if(!r)return console.log("Error: configuration is required to create passenger box.");for(var s,n=0,a=this.sBoxID,o=r.styles?" "+r.styles:"",l=t.length,i=_after({el:e,selNew:"div",sID:"passbox_"+a,sCSS:"passbox"+o}),c=_appendChild({el:i,selNew:"label",sText:"Password Must:"}),u=_after({el:c,selNew:"ul"}),d=document.createDocumentFragment(),p=a+"-rule-";l>n;n++)s=document.createElement("li"),s.textContent=t[n].label,s.id=p+t[n].name,d.appendChild(s);return u.appendChild(d),i},Passenger.prototype.boxDisplayToggle=function(e,t){function r(){var e=t.className,r=e.indexOf("show");return e=-1!=r?e.substr(0,r-1):t.className+" show",t.className=e,!1}if(!e||!t)return console.log("Error: need both, the element to add box toggle link and the box itself");var s=this.sBoxID,n=_after({el:e,selNew:"a",sID:"passbox_guide_toggle_"+s,sCSS:"toggle_guide_link",sText:"Toggle Guide",aAttr:[{name:"href",val:"#"}]});return n.addEventListener("click",r,!1),n},Passenger.prototype.inputTypeToggle=function(e){function t(){var t=e.getAttribute("type"),r="password"===t?"text":"password";return e.setAttribute("type",r),e}if(!e)return console.log("Error: field element required.");var r=this.sBoxID,s=_after({el:e,selNew:"a",sID:"passbox_type_toggle_"+r,sText:"Toggle Password",sCSS:"toggle_input_link",aAttr:[{name:"href",val:"#"}]});return s.addEventListener("click",t,!1),s},Passenger.prototype.bAllPassed=function(e,t){},Passenger.prototype.setupBoxEvents=function(e,t){var r="keyup",s=this;return e.addEventListener("focus",function(e){return this.contracts||(this.contracts=s.contracts),t.className?t.className=t.className+" show":t.className="show",this.addEventListener(r,s.userEntry,!1)},!1),e.addEventListener("blur",function(e){this.removeEventListener(r,s.userEntry,!1)},!1),e},Passenger.prototype.userEntry=function(e){for(var t,r,s,n,a,o=0,l=this.id,i=this.contracts,c=i.length,u=!0,d=l+"-rule-",p=e.target.value;c>o;o++)t=i[o].rule,r=new RegExp(t),s=i[o].name,n=r.test(p),a=document.getElementById(d+s),n?a.className="met":(a.className="",u=!1);passengers[l].fulfilled=u},Passenger.prototype.getElement=function(e){if(!e)return console.log("Error: selector is required.");var t=document.getElementById(e);return t||console.log("Error: cannot find selector.")},Passenger.prototype.getContracts=function(){var e=[{name:"lowercase",label:"Have at least one lower case character",rule:"[a-z]"},{name:"uppercase",label:"Have at least one upper case character",rule:"[A-Z]"},{name:"number",label:"Have at least one number",rule:"[0-9]"},{name:"consecutive",label:"Avoid using three or more consecutive identical characters",rule:"^(?!.*(.)\\1\\1)"},{name:"min6",label:"A minimum of 6 characters",rule:"^.{6,}$"},{name:"max12",label:"A maximum of 12 characters",rule:"^.{1,12}$"},{name:"notcommon",label:"Not be a common password",rule:"^((?!(password|abcdefgh|asdflkjh|abcd1234)).)*$"}];return e};